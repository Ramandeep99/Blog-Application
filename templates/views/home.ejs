<%- include('../partials/header', {fileName: '/css/navbar.css' , fileName2: '/css/home.css' }); %>



    <body>
        <%- include("../partials/navbar") %>

            <!-- div seperation -->
            <div class="container-fluid">
                <div class="row">
                    <!-- to get space from sides -->
                    <div class="col-xl-10 col-lg-10 col-md-11 col-11 mx-auto mb-5 mt-5">
                        <div class="row gx-5 mx-sm-auto">
                            <!-- to get left side div -->
                            <div class="col-lg-8 col-md-11 col-11 mx-auto">
                                <div class="row gy-5">
                                    <!-- first blog -->
                                    <% articles.forEach(article=> { %>
                                        <div class="col-12 card shadow p-4 blog_left__div mb-5">
                                            <div
                                                class="d-flex justify-content-center align-items-center flex-column pt-3 pb-3">
                                                <h1 class="read_more"
                                                    onclick="document.location.href = 'http:/articles/<%= article.slug %>'">
                                                    <%= article.title %>
                                                </h1>
                                                <p class="blog_title">Created On: <span class="font-weight-bold">
                                                        <%= article.createdAt.toLocaleDateString() %>
                                                    </span> </p>
                                                <p class="blog_title">Created By: <span
                                                        onclick="userProfile_func(event)"
                                                        data-post-id="<%= article.createdBy._id %>" id="userName"
                                                        class="font-weight-bold">
                                                        <%= article.createdBy.name %> <span id="in">in</span> <span>
                                                                <%= article.category %>
                                                            </span>
                                                    </span> </p>
                                            </div>


                                            <figure class="right_side__img mb-5">


                                                <div id="carouselExampleControls" class="carousel slide"
                                                    data-ride="carousel">

                                                    <div class="carousel-inner">

                                                        <% for(var i=0;i<article.image.length;i++) { %>
                                                            <% if(i==0) { %>
                                                                <div class="carousel-item active">
                                                                    <img src="/uploads/<%= article.image[i].filename %>"
                                                                        class="d-block w-100" alt="...">
                                                                </div>
                                                                <% } else { %>
                                                                    <div class="carousel-item">
                                                                        <img src="/uploads/<%= article.image[i].filename %>"
                                                                            class="d-block w-100 img-fluid shadow"
                                                                            alt="...">
                                                                    </div>
                                                                    <% } %>
                                                                        <% } %>
                                                    </div>

                                                    <!-- <a class="carousel-control-prev" href="#carouselExampleControls"
                                                        role="button" data-slide="prev">
                                                        <span class="carousel-control-prev-icon"
                                                            aria-hidden="true"></span>
                                                        <span class="sr-only">Previous</span>
                                                    </a>
                                                    <a class="carousel-control-next" href="#carouselExampleControls"
                                                        role="button" data-slide="next">
                                                        <span class="carousel-control-next-icon"
                                                            aria-hidden="true"></span>
                                                        <span class="sr-only">Next</span>
                                                    </a> -->
                                                </div>

                                            </figure>






                   









                                            <p class="read_more"
                                                onclick="document.location.href = '/articles/<%= article.slug %>'">
                                                Lorem
                                                Lorem ipsum dolor sit amet consectetur
                                                adipisicing elit. Ipsam, libero
                                                veritatis ullam officia sit error laboriosam omnis dolor vero
                                                repellat!
                                                ipsum dolor sit amet consectetur adipisicing elit. Blanditiis
                                                sint ullam
                                                placeat vitae laudantium recusandae architecto temporibus
                                                delectus est
                                                esse.
                                            </p>
                                            <p class=" read_more"
                                                onclick="document.location.href = '/articles/<%= article.slug %>'">
                                                Lorem
                                                Lorem ipsum dolor sit amet consectetur
                                                adipisicing elit. Sunt quas
                                                illum dolorem commodi? ipsum dolor sit amet consectetur
                                                adipisicing
                                                elit.
                                                Dignissimos, ipsum.</p>
                                            <div class="d-flex justify-content-between left_div_btns">

                                                <% if(article.likes.includes(user._id)) { %>
                                                    <div>
                                                        <button onclick="like_func(event);"
                                                            data-post-id="<%= article.id %>" class="left_div__like"
                                                            id="like_btn">
                                                            Unlike
                                                        </button>
                                                        <span id="likes-count-<%= article.id %>">
                                                            <%= article.likes.length %>
                                                        </span>
                                                    </div>
                                                    <% } else { %>
                                                        <div>
                                                            <button onclick="like_func(event);"
                                                                data-post-id="<%= article.id %>" class="left_div__like"
                                                                id="like_btn">
                                                                Like
                                                            </button>
                                                            <span id="likes-count-<%= article.id %>">
                                                                <%= article.likes.length %>
                                                            </span>
                                                        </div>
                                                        <% } %>
                                                            <% if(user.bookmarks.includes(article._id)) { %>
                                                                <div>
                                                                    <button onclick="save_func(event);"
                                                                        data-post-id="<%= article.id %>"
                                                                        class="left_div__save" id="save_btn">
                                                                        Unsave
                                                                    </button>
                                                                </div>
                                                                <% } else { %>
                                                                    <div>
                                                                        <button onclick="save_func(event);"
                                                                            data-post-id="<%= article.id %>"
                                                                            class="left_div__save" id="save_btn">
                                                                            Save
                                                                        </button>
                                                                    </div>
                                                                    <% } %>

                                            </div>
                                        </div>
                                        <% }) %>
                                </div>
                            </div>
                            <!-- to get right side div -->
                            <div class="col-lg-3 col-md-9 col-11 justify-content-center m-lg-0 m-auto fixedElement "
                                style="overflow:scroll; height:610px;" id="rightDiv">
                                <div class="right_div__post">
                                    <div class="right_div__title py-4 pl-2">
                                        <h2>Profile</h2>
                                    </div>
                                    <div class="right_sub__div">
                                        <div class="profile_img mb-4"><i class="fas fa-portrait" id="photo-icon"></i>
                                        </div>
                                        <div class="profile_main bg-light shadow">
                                            <p>
                                                <%= user.name %>
                                            </p>
                                        </div>
                                        <div class="follow-follower mt-4 ">
                                            <p class="bg-light shadow">Follower <strong class="mx-3">
                                                    <%= user.followers.length %>
                                                </strong></p>
                                            <p class="bg-light shadow">Following <strong class="mx-3">
                                                    <%= user.following.length %>
                                                </strong> </p>
                                            <!-- on clicking this user can move to his/her profile page work to do -->
                                            <p class="bg-light shadow"> <a href="/login_signup/bookmark">BookMarks</a>
                                            </p>
                                            <!-- create new -->
                                            <p class="bg-light shadow"> <a href="/articles/new">Create New</a></p>
                                            <!-- <a href="/articles/new" class="btn btn-success">New Article</a> -->

                                        </div>
                                    </div>
                                </div>

                                <div class="right_div__post mt-5">
                                    <div class="right_div__title py-4 pl-2">
                                        <h2>Tags</h2>
                                    </div>
                                    <div class="tags_main right_sub__div">
                                        <a href="#" class="badge shadow text-capitalize category"> Music </a>
                                        <a href="#" class="badge shadow text-capitalize category"> Technology </a>
                                        <a href="#" class="badge shadow text-capitalize category"> Cricket </a>
                                        <a href="#" class="badge shadow text-capitalize category"> Internet </a>
                                        <a href="#" class="badge shadow text-capitalize category"> Books </a>
                                        <a href="#" class="badge shadow text-capitalize category"> Travel </a>
                                        <a href="#" class="badge shadow text-capitalize category"> Food </a>
                                        <a href="#" class="badge shadow text-capitalize category"> Agriculture </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- JS  -->
            
            <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
                integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
                crossorigin="anonymous"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js"
                integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/"
                crossorigin="anonymous"></script>
            <script>

                // for category

                const categories = document.querySelectorAll('.category');

                categories.forEach(category => {
                    category.addEventListener('click', async (e) => {
                        const type = e.target.innerText;
                        e.preventDefault();
                        try {
                            const result = await fetch(`/articles/category/${type}`, {

                                method: 'GET',
                                headers: {
                                    "Content-Type": "application/json",
                                }
                            })
                            const data = await result;
                            // console.log(data)
                            location.assign(data.url);
                        }
                        catch (err) {
                            console.log('err')
                        }
                    })
                })


                // for user profile
                const userProfile_func = async (e) => {
                    e.preventDefault();
                    var postId = event.target.dataset.postId;

                    try {
                        const otherUser = await fetch(`/login_signup/other_profile/${postId}`, {

                            method: 'GET',
                            headers: {
                                "Content-Type": "application"
                            }
                        });
                        const data = await otherUser;
                        // console.log(data)
                        location.assign(data.url);

                    }
                    catch (err) {
                        console.log(err)
                    }
                };


                // for like btn
                const like = document.getElementById('like_btn');

                var toggleButtonText = {
                    Like: function (button) {
                        button.textContent = "Unlike";
                    },
                    Unlike: function (button) {
                        button.textContent = "Like";
                    }
                };

                var updatePostStats = {
                    Like: function (postId) {
                        document.querySelector('#likes-count-' + postId).textContent++;
                    },
                    Unlike: function (postId) {
                        document.querySelector('#likes-count-' + postId).textContent--;
                    }
                };

                const like_func = async (e) => {
                    e.preventDefault();
                    var postId = event.target.dataset.postId;

                    var action = event.target.textContent.trim();
                    // console.log(action)
                    toggleButtonText[action](event.target);
                    updatePostStats[action](postId);

                    try {
                        const liked = await fetch(`/articles/like/${postId}`, {

                            method: 'PUT',
                            headers: {
                                "Content-Type": "application/json",
                            }
                        })
                        console.log(liked.json())
                    }
                    catch (err) {
                        console.log('err')
                    }
                };


                // for save btn               

                var toggleButtonTextSave = {
                    Save: function (button) {
                        button.textContent = "Unsave";
                    },
                    Unsave: function (button) {
                        button.textContent = "Save";
                    }
                };


                const save_func = async (e) => {

                    e.preventDefault();
                    var postId = event.target.dataset.postId;
                    console.log(postId)

                    // we can also implement that a post a alread saved in a user collection or not with action below
                    var action = event.target.textContent.trim();

                    toggleButtonTextSave[action](event.target);


                    try {
                        const saved = await fetch(`/login_signup/bookmark/${postId}`, {

                            method: 'PUT',
                            headers: {
                                "Content-Type": "application/json",
                            }
                        })
                        const data = await saved;
                        console.log(data)
                        // location.assign(data.url);
                    }
                    catch (err) {
                        console.log(err)
                    }
                };

                // const save = document.getElementById('save_btn');
                // const singleClick_ = () => {
                //     save.style.fontWeight = 'bold';
                //     save.style.background = '#bbe1fa';
                //     save.style.color = '#1b262c';
                //     save.innerHTML = "Saved";
                // }
                // const doubleClick_ = () => {
                //     save.style.fontWeight = 'normal';
                //     save.style.background = '#3282b8';
                //     save.style.color = '#fff';
                //     save.innerHTML = "Save";
                // }
                // var clickCount = 0;
                // save.addEventListener('click', function () {
                //     clickCount++;
                //     if (clickCount === 1) {
                //         singleClickTimer = setTimeout(function () {
                //             clickCount = 0;
                //             singleClick_();
                //         }, 400);
                //     } else if (clickCount === 2) {
                //         clearTimeout(singleClickTimer);
                //         clickCount = 0;
                //         doubleClick_();
                //     }
                // }, false);





                // logic to make rightside sticky

                // stickyElem =
                //     document.querySelector(".sticky-div");

                // /* Gets the amount of height
                // of the element from the
                // viewport and adds the
                // pageYOffset to get the height
                // relative to the page */
                // currStickyPos =
                //     stickyElem.getBoundingClientRect().top + window.pageYOffset;

                // window.onscroll = function () {

                /* Check if the current Y offset
                is greater than the position of
                the element */
                //     if (window.pageYOffset > currStickyPos) {
                //         stickyElem.style.position = "fixed";
                //         stickyElem.style.top = "1rem";
                //     } else {
                //         stickyElem.style.position = "relative";
                //         stickyElem.style.top = "initial";
                //     }
                // }

            </script>



    </body>

    </html>